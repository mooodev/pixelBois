<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
     <link rel="icon" type="image/x-icon" href="https://mooodev.github.io/pixelBois/breathtakingSite/favico.png">
    <meta charset="utf-8">
    <title>PIXEL BOIZ</title>
    <style media="screen">
      hr{
        background-color:#50C878;
        height:15px;
        width:90%;
        border-radius: 20px;
      }
      .hrText{
        position:absolute;
        margin-top:-20px;
        color:black;
      }
      .flex-container {
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    justify-content: flex-start;
    align-content: stretch;
    align-items: flex-start;
    }

.flex-item:nth-child(1) {
    order: 0;
    flex: 0 1 auto;
    align-self: flex-end;
    }

.flex-item:nth-child(2) {
    order: 0;
    flex: 0 1 auto;
    align-self: center;
    }

.flex-item:nth-child(3) {
    order: 0;
    flex: 0 1 auto;
    align-self: center;
    }
    .card {
box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
transition: 0.3s;
border-radius: 5px; /* 5px rounded corners */
width: 20%;
position:relative;
display:inline-block;
background-color:#816797;
margin: auto;
margin: 10px;
filter: drop-shadow(0px 0px 7px #51557E);
}

/* Add rounded corners to the top left and the top right corner of the image */
img {
  width : 100%;
border-radius: 5px 5px 0 0;
}
body{
  background-color:#1B2430;
  color:#D6D5A8;
  text-align:center;
}
button{
  background-color:#51557E;
}
    </style>
  </head>
  <body>

<div class="flex-container">
  <div class="flex-item">
    <button onclick="controller.connectMM()"  type="button" name="button">ðŸ¦ŠConnect Metamask</button>
    <!-- <button type="button" name="button">â›µGo to OpenSea</button> -->
    <a id="_mainStats"></a>
  </div>
  <div class="flex-item">BOI-ACCOUNT: <i id="_addressMain">0x</i></div>
  <div class="flex-item" id="nftHolder">


  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.1-rc.0/web3.min.js"></script>
<script type="text/javascript">
//color pallette #1B2430 #51557E #816797 #D6D5A8
  class PfpDownloader {
      constructor() {
          this.web3;
          this.myAddress;
          this.osResponse = undefined;
          this.osStats = undefined;
          this.contractInstance;
          this.myNfts = [];
          this.totalOwned = 12345;
          this._lastExtraBit = '';
      }
      async connectMM() {
        controller.osResponse = undefined;
        document.getElementById("nftHolder").innerHTML = ''
        controller._addLoadingCard();
          const accounts = await ethereum.request({
              method: 'eth_requestAccounts'
          });
          const account = accounts[0];
          myMMAccount = account;
          document.getElementById("_addressMain").innerHTML = myMMAccount.toString()
          controller.getBalanceOf(myMMAccount)
          controller.getDataFromOS(myMMAccount)
      }
      getDataFromOS(address,extra){
          const Http = new XMLHttpRequest();
          let url = 'https://api.opensea.io/api/v1/assets?owner=';
          url += address;
          url += "&limit=30"
          if(extra){
            url += "&cursor="+extra;
          }
          Http.open("GET", url);
          Http.send();
          Http.onreadystatechange = (e) => {
              if (Http.responseText.charAt(0) == "{" && Http.responseText.charAt(Http.responseText.length-1) == "}" ) {
                if(controller._lastExtraBit !== JSON.stringify(JSON.parse(Http.responseText).next)){
                  console.log("recived opensea page")
                  controller._lastExtraBit = JSON.stringify(JSON.parse(Http.responseText).next);
                  controller.osResponse = JSON.stringify(JSON.parse(Http.responseText));
                  controller.searchForOwnerNfts()
                }
              }
              return true;
          }
      }
      searchForOwnerNfts() {
        document.getElementById("nftHolder").innerHTML = ''
          for (let n = 0; n < JSON.parse(controller.osResponse).assets.length; n++) {
            let _new = true;
            for(let n1 = 0 ; n1 < controller.myNfts.length ; n1++){
              if(JSON.parse(controller.osResponse).assets[n].name == controller.myNfts[n1].name)_new = false;
            }
            if (JSON.parse(controller.osResponse).assets[n].description == "My Breathtaking Pixel Bois" && _new) {
                controller.myNfts.push(JSON.parse(controller.osResponse).assets[n])
            }
          }
          for(let m = 0 ; m < controller.myNfts.length ; m++){
            controller.addCard(controller.myNfts[m].name)
          }
          if(JSON.parse(controller.osResponse).next !== null && controller.totalOwned > controller.myNfts.length){
            controller._addLoadingCard()
            controller.getDataFromOS(myMMAccount,JSON.stringify(JSON.parse(controller.osResponse).next))
          }
          return true;
      }
      addCard(name){
          let _id = name.slice(5)
          let _div = document.createElement("div");
          let _saveButton = document.createElement("button");
          _saveButton.innerHTML = "ðŸ’¾"
          _saveButton.id = _id;
          _saveButton.addEventListener("click", (e) => {
            controller.savePfp(e.path[0].id)
          });
          _saveButton.style.position = "absolute"
          _div.appendChild(_saveButton);
          _div.classList.add('card');
          let _img = document.createElement("img");
          _img.src = "https://raw.githubusercontent.com/mooodev/pixelBois/main/pfpDownloader/images/" + _id + ".png"
          _img.alt = name;
          let _divCont = document.createElement("div");
          _divCont.classList.add('container');
          let _name = document.createElement("h3");
          _name.innerHTML = name;
          _divCont.appendChild(_name);
          _div.appendChild(_img);
          let _healthBar = document.createElement("hr");
          _div.appendChild(_healthBar);
          _div.appendChild(_divCont);
          document.getElementById("nftHolder").appendChild(_div)
      }
      _addLoadingCard(){
          let _div = document.createElement("div");
          _div.classList.add('card');
          let _img = document.createElement("img");
          _img.src = "https://raw.githubusercontent.com/mooodev/pixelBois/main/breathtakingSite/bookloader.gif"
          _img.alt = "loading nfts";
          let _divCont = document.createElement("div");
          _divCont.classList.add('container');
          let _name = document.createElement("h3");
          _name.innerHTML = "Loading..";
          let _name2 = document.createElement("p");
          _name2.innerHTML = "Plase await";
          _divCont.appendChild(_name2);
          _divCont.appendChild(_name);
          _div.appendChild(_img);
          _div.appendChild(_divCont);
          document.getElementById("nftHolder").appendChild(_div)
      }
      _addStartCard(){
        let _rand = Math.random()
          let _div = document.createElement("div");
          _div.classList.add('card');
          let _img = document.createElement("img");
          if(_rand < 0.5){
            _img.src = "https://raw.githubusercontent.com/mooodev/pixelBois/main/pfpDownloader/images/20.png"
          }else{
            _img.src = "https://raw.githubusercontent.com/mooodev/pixelBois/main/pfpDownloader/images/179.png"
          }
          _img.alt = "hello welcoming boi";
          let _divCont = document.createElement("div");
          _divCont.classList.add('container');
          let _name = document.createElement("p");
          let _name2 = document.createElement("h4");
          if(_rand < 0.5){
            _name2.innerHTML = "Boi#20: Wuzza fren!";
          }else{
            _name2.innerHTML = "Boi#179: Officer Pigging reporting!";
          }
          _name.innerHTML = "Here sir you can view and save your BOI nft's.";
          _name.id = 'info_screen'
          _name.style.padding = "5px"
          _divCont.appendChild(_name2);
          _divCont.appendChild(_name);
          _div.appendChild(_img);
          _div.appendChild(_divCont);
          document.getElementById("nftHolder").appendChild(_div)
      }
      async getStatsFromOS(){
          const Http = new XMLHttpRequest();
          let url = 'https://api.opensea.io/api/v1/collection/my-breathtaking-pixel-bois/stats';
          await Http.open("GET", url);
          await Http.send();
          Http.onreadystatechange = (e) => {
              if (Http.responseText.charAt(0) == "{") {
                      if (this.osStats == undefined) {
                          this.osStats = JSON.parse(Http.responseText);
                          controller.displayStats();
                      }
              }
              return true;
          }
      }
      displayStats(){
        console.log(this.osStats)
        let statsText = '<br>'
        statsText += "Market Cap:"+this.osStats.stats.market_cap+" ETH<br>"
        statsText += "Floor:"+this.osStats.stats.floor_price+" ETH<br>"
        // statsText += "Owners:"+osstats.stats.num_owners+"<br>"
        statsText += "Total sales:"+this.osStats.stats.total_sales+"<br>"
        document.getElementById("_mainStats").innerHTML = statsText;
      }
      savePfp(id) {
          let a = document.createElement('a');
          a.href = "https://raw.githubusercontent.com/mooodev/pixelBois/main/pfpDownloader/images/" + id + ".png";
          a.download = id + ".png";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
      }
      async getBalanceOf(address){
        await this.contractInstance.methods.balanceOf(address).call().then(function(total) {
        console.log(address + " owns total " + total);
        controller.totalOwned = Number(total);
        if(total == 0){
          //you dont own any!
          document.getElementById("nftHolder").innerHTML = ''
          controller._addStartCard();
          document.getElementById("info_screen").innerHTML = "Oh no looks likt you dont own any BOIZ D:"
        }
      })
  }
}
  const controller = new PfpDownloader()
  const Contract = "0x0568A87e64E65f4cC7898E08f0e57FFe2AA6241f"

  window.onload = function() {
    controller.web3 = new Web3(window.ethereum);
    controller.contractInstance = new controller.web3.eth.Contract(myAbi, Contract);
      document.getElementById("nftHolder").style.width = "100%";
      controller.getStatsFromOS();
      controller._addStartCard()
  };

  var myAbi = [
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "approved",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "Approval",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "operator",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "bool",
          "name": "approved",
          "type": "bool"
        }
      ],
      "name": "ApprovalForAll",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "previousOwner",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "newOwner",
          "type": "address"
        }
      ],
      "name": "OwnershipTransferred",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "from",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "Transfer",
      "type": "event"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "approve",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        }
      ],
      "name": "balanceOf",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "baseTokenURI",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "_maxAmount",
          "type": "uint256"
        }
      ],
      "name": "changeMaxMint",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "contractURI",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "getApproved",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "operator",
          "type": "address"
        }
      ],
      "name": "isApprovedForAll",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "mintFree",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "name",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "owner",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "ownerOf",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "renounceOwnership",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "from",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "safeTransferFrom",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "from",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        },
        {
          "internalType": "bytes",
          "name": "_data",
          "type": "bytes"
        }
      ],
      "name": "safeTransferFrom",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "operator",
          "type": "address"
        },
        {
          "internalType": "bool",
          "name": "approved",
          "type": "bool"
        }
      ],
      "name": "setApprovalForAll",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "string",
          "name": "_baseTokenURI",
          "type": "string"
        }
      ],
      "name": "setBaseTokenURI",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes4",
          "name": "interfaceId",
          "type": "bytes4"
        }
      ],
      "name": "supportsInterface",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "symbol",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "tokenURI",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "totalMinted",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "from",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "tokenId",
          "type": "uint256"
        }
      ],
      "name": "transferFrom",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "newOwner",
          "type": "address"
        }
      ],
      "name": "transferOwnership",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ]

</script>

  </body>
</html>
